<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>access-specification - Property Data Trust Framework</title>
            <style>
                body { 
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
                    line-height: 1.6;
                    max-width: 900px;
                    margin: 0 auto;
                    padding: 2rem;
                    color: #24292e;
                }
                h1, h2, h3 { color: #0366d6; }
                code { 
                    background: #f6f8fa;
                    padding: 0.2em 0.4em;
                    border-radius: 3px;
                    font-size: 85%;
                }
                pre {
                    background: #f6f8fa;
                    padding: 16px;
                    overflow: auto;
                    border-radius: 6px;
                }
                a { color: #0366d6; text-decoration: none; }
                a:hover { text-decoration: underline; }
                .nav {
                    background: #f6f8fa;
                    padding: 1rem;
                    margin-bottom: 2rem;
                    border-radius: 6px;
                }
                .nav ul {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                }
                .nav li {
                    display: inline-block;
                    margin-right: 1rem;
                }
            </style>
        </head>
        <body>
            <nav class="nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="governance.html">Governance</a></li>
                    <li><a href="../">Registry</a></li>
                </ul>
            </nav>
            <main>
<p>Property Data Trust Framework (PDTF)</p>
<p>Transaction DID + REST Access Specification (Draft v0.1)</p>
<p>Status: Draft for internal review
Editors: PDTF team
Intended audience: Architects, implementers of hubs (AS/RS), wallet vendors, issuer integrators</p>
<p>⸻</p>
<ol>
<li>Purpose &amp; Scope</li>
</ol>
<p>This specification describes how residential property transaction data is protected and exchanged across multiple hubs using:
• A Transaction DID as the root of discovery and governance for a single transaction.
• The Transaction DID Document to declare authoritative hubs.
• OID4VP as the authorization grant to obtain OAuth 2.0 access tokens.
• RESTful endpoints as the resource interface for reading and writing Verifiable Credentials (VCs) and related artifacts.
• Issuer status lists for revocation and lifecycle, without a central anchor/registration VC.</p>
<p>Out of scope: wallet UX, notarization of non-VC artifacts, off-ledger settlement. Informative guidance is included where useful.</p>
<p>⸻</p>
<ol start="2">
<li>Terminology</li>
</ol>
<p>MUST/SHOULD/MAY are to be interpreted as in RFC 2119.
Transaction: a residential property transaction (buy/sell/mortgage) with a unique DID.
Hub: a system that exposes an Authorization Server (AS) and a Resource Server (RS) for a transaction.
Issuer: a trusted party that issues VCs (e.g., conveyancer, land registry, surveyor, lender).
Participant VC: a VC asserting that a subject plays a role in a specific transaction.
Trust Registry: authoritative list of ecosystem issuer DIDs and metadata.
Status List: revocation/status mechanism for credentials (e.g., StatusList2021 or SD‑JWT Status).</p>
<p>⸻</p>
<ol start="3">
<li>Architecture Overview<ol>
<li>Each transaction is identified by a Transaction DID (e.g., did:web:pdtf.example/tx/12345 or did:ion:...).</li>
<li>The DID Document names:
• Authoritative Hubs (AS/RS base URLs, audiences, metadata)</li>
<li>Holders obtain Participant VCs from issuers and present them via OID4VP to a hub&#39;s AS.</li>
<li>The AS verifies the presentation, the issuer status against the Trust Registry, and applies dynamic authorization rules based on each VC&#39;s termsOfUse, then issues a short‑lived, DPoP‑bound OAuth access token.</li>
<li>Clients call RESTful endpoints on the RS with that token to GET or POST domain VCs and artifacts.</li>
</ol>
</li>
</ol>
<p>⸻</p>
<ol start="4">
<li>Transaction DID and DID Document</li>
</ol>
<p>4.1 Requirements
• A transaction MUST have a unique DID (the Transaction DID).
• The DID controller(s) MUST be the transaction coordinator/owner(s) under governance policy.
• The DID Document MUST publish:
• One or more Hub Service entries for the authoritative hubs.
• DID Document SHOULD be versioned (method support or external signed changelog).
• Verifiers MUST re-resolve the DID Doc at token issuance time (or use fresh cache with ETag/TTL ≤ 5 minutes).</p>
<p>4.2 Service Types</p>
<h4>4.2.1 PDTFHubAuthorizationService</h4>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;#hub-as-1&quot;,
  &quot;type&quot;: &quot;PDTFHubAuthorizationService&quot;,
  &quot;serviceEndpoint&quot;: {
    &quot;issuer&quot;: &quot;https://hub-a.example/&quot;,
    &quot;authorization_endpoint&quot;: &quot;https://hub-a.example/oidc/authorize&quot;,
    &quot;token_endpoint&quot;: &quot;https://hub-a.example/oidc/token&quot;,
    &quot;jwks_uri&quot;: &quot;https://hub-a.example/oidc/jwks.json&quot;,
    &quot;introspection_endpoint&quot;: &quot;https://hub-a.example/oidc/introspect&quot;,
    &quot;RAR_types&quot;: [&quot;pdtf:transaction&quot;],
    &quot;aud&quot;: &quot;https://hub-a.example/api&quot;
  }
}
</code></pre>
<h4>4.2.2 PDTFHubResourceService</h4>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;#hub-rs-1&quot;,
  &quot;type&quot;: &quot;PDTFHubResourceService&quot;,
  &quot;serviceEndpoint&quot;: {
    &quot;api_base&quot;: &quot;https://hub-a.example/api&quot;,
    &quot;version&quot;: &quot;v1&quot;,
    &quot;capabilities&quot;: [
      &quot;GET /transactions/{txDid}/vcs&quot;,
      &quot;POST /transactions/{txDid}/vcs&quot;,
      &quot;GET /artifacts/{hash}&quot;
    ]
  }
}
</code></pre>
<p>4.3 DID Methods
• Any DID method MAY be used if it supports timely document updates and widespread resolution.
• For did:web, controllers SHOULD publish a signed change log URL in a PDTFChangeLog service for auditability.</p>
<p>⸻</p>
<ol start="5">
<li>Credential Profiles</li>
</ol>
<p>5.1 Formats
• Hubs and issuers MUST support VC Data Model + JSON-LD with Linked Data Proofs using Ed25519.</p>
<p>5.2 Participant VC (normative, minimal)</p>
<p>Purpose: assert a subject’s role in a specific transaction.</p>
<p>Constraints:
• credentialSubject.txDid MUST equal the Transaction DID.
• issuer MUST be present in the Trust Registry.
• credentialStatus MUST reference an issuer‑hosted status list.</p>
<p><strong>Example (JSON-LD with Linked Data Proof):</strong></p>
<pre><code class="language-json">{
  &quot;@context&quot;: [
    &quot;https://www.w3.org/2018/credentials/v1&quot;, 
    &quot;https://trust.propdata.org.uk/contexts/pdtf-v2.jsonld&quot;
  ],
  &quot;type&quot;: [&quot;VerifiableCredential&quot;, &quot;ParticipantVC&quot;],
  &quot;issuer&quot;: &quot;did:web:conveyancer.example&quot;,
  &quot;validFrom&quot;: &quot;2025-08-20T11:32:00Z&quot;,
  &quot;credentialSubject&quot;: {
    &quot;id&quot;: &quot;did:pairwise:buyer#tx-12345&quot;,
    &quot;txDid&quot;: &quot;did:web:pdtf.example/tx/12345&quot;,
    &quot;role&quot;: &quot;buyer&quot;
  },
  &quot;credentialStatus&quot;: {
    &quot;type&quot;: &quot;StatusList2021Entry&quot;,
    &quot;statusPurpose&quot;: &quot;revocation&quot;,
    &quot;statusListIndex&quot;: &quot;1024&quot;,
    &quot;statusListCredential&quot;: &quot;https://conveyancer.example/status/participants/sl2021.json&quot;
  },
  &quot;proof&quot;: {
    &quot;type&quot;: &quot;Ed25519Signature2020&quot;, 
    &quot;created&quot;: &quot;2025-08-20T11:32:05Z&quot;,
    &quot;proofPurpose&quot;: &quot;assertionMethod&quot;,
    &quot;verificationMethod&quot;: &quot;did:web:conveyancer.example#key-1&quot;,
    &quot;jws&quot;: &quot;eyJhbGciOi...&quot;
  }
}
</code></pre>
<p>⸻</p>
<ol start="6">
<li>Authorization Model</li>
</ol>
<p>6.1 Overview
• OAuth 2.0 is used for API access.
• The authorization grant is OID4VP (presentation of required VCs).
• Tokens are DPoP‑bound and short‑lived.</p>
<p>6.2 Presentation Definition (PEX)</p>
<p>The AS MUST publish or embed a presentation_definition requiring a valid Participant VC for the requested txDid:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;pdtf-participant&quot;,
  &quot;input_descriptors&quot;: [
    {
      &quot;id&quot;: &quot;participant-vc&quot;,
      &quot;constraints&quot;: {
        &quot;fields&quot;: [
          {
            &quot;path&quot;: [&quot;$.type[*]&quot;], 
            &quot;filter&quot;: {
              &quot;type&quot;: &quot;string&quot;, 
              &quot;pattern&quot;: &quot;^ParticipantVC$&quot;
            }
          },
          {
            &quot;path&quot;: [&quot;$.credentialSubject.txDid&quot;], 
            &quot;filter&quot;: {
              &quot;const&quot;: &quot;did:web:pdtf.example/tx/12345&quot;
            }
          }
        ]
      }
    }
  ]
}
</code></pre>
<p>The AS MUST verify that the VC&#39;s issuer appears in the ecosystem Trust Registry, and that status is good.</p>
<h4>6.2.1 Dynamic Access Control</h4>
<p>Access to VCs is determined by their <code>termsOfUse.confidentialityLevel</code>:</p>
<p>• <strong><code>Public</code></strong>: No authentication required - any client can access<br>• <strong><code>Restricted</code></strong>: Requires a valid Participant VC for the transaction (any role)<br>• <strong><code>Confidential</code></strong>: Requires specific role-based Participant VC or specific participant DID as defined in the VC&#39;s <code>termsOfUse.requiredCredentials</code></p>
<p>The AS MUST evaluate each VC&#39;s termsOfUse independently when filtering responses.</p>
<p>6.3 Rich Authorization Requests (RAR)</p>
<p>Clients SHOULD request fine‑grained scopes via authorization_details:</p>
<pre><code class="language-json">{
  &quot;authorization_details&quot;: [
    {
      &quot;type&quot;: &quot;pdtf:transaction&quot;,
      &quot;txDid&quot;: &quot;did:web:pdtf.example/tx/12345&quot;,
      &quot;permissions&quot;: [
        &quot;read:vc:domain/title&quot;,
        &quot;read:vc:domain/local-searches&quot;,
        &quot;post:vc:domain/surveys&quot;
      ]
    }
  ]
}
</code></pre>
<p>The AS maps satisfied VPs to permitted permissions and encodes them as OAuth scopes/claims.</p>
<p>6.4 Token Requirements
• Access tokens MUST be bound to a DPoP key (cnf/jkt).
• aud MUST equal the RS base URL published in PDTFHubResourceService.
• Lifetimes: access token ≤ 10 min; refresh token ≤ 1 hour (policy‑dependent).
• RS MUST validate DPoP, signature, issuer, audience, expiry, and required scopes.</p>
<p>6.5 Step‑up &amp; Re‑auth</p>
<p>For sensitive operations, the RS MAY return 401 with an authorization challenge directing the client to re‑run OID4VP (e.g., require specific role-based Participant VC).</p>
<p>⸻</p>
<ol start="7">
<li>RESTful Resource API (RS)</li>
</ol>
<p>7.1 Common
• Base URL from PDTFHubResourceService.serviceEndpoint.api_base.
• All requests MUST use TLS and include Authorization: Bearer <token> and a valid DPoP proof.
• Responses SHOULD include Cache-Control appropriate to content and ETags for artifact bodies.</p>
<p>7.2 Endpoints (normative)</p>
<p>7.2.1 List/Query VCs</p>
<p>GET /transactions/{txDid}/vcs</p>
<p>Query params (optional):
• type — VC type (e.g., domain/title, SurveyReportVC)
• latest — true|false (default true)
• issuer — filter by issuer DID
• since — ISO8601 timestamp filter</p>
<p>Responses:
• 200 OK — JSON array of VCs (base64url encoded JWS or JSON‑LD objects), or VC summaries, filtered based on each VC&#39;s termsOfUse confidentialityLevel.
• 401/403 — auth errors.
• 404 — transaction unknown to this hub.</p>
<p><strong>Example:</strong></p>
<pre><code class="language-http">GET /api/transactions/did:web:pdtf.example:tx:12345/vcs?type=domain/title&amp;latest=true
Authorization: Bearer eyJhbGciOi...
DPoP: eyJhbGciOi...
</code></pre>
<p>7.2.2 Submit a VC</p>
<p>POST /transactions/{txDid}/vcs</p>
<p>Body: a VC the client proposes to add to the transaction repository.
Requirements: RS MUST validate schema, signature, issuer trust, status, and that the caller’s token scope permits posting that VC type.
Responses: 201 Created with Location of the stored VC; or 400/403/422 with error details.</p>
<p>7.2.3 Retrieve an Artifact</p>
<p>GET /artifacts/{hash} — returns a binary artifact (e.g., PDF) referenced by a VC.
The RS MUST enforce token scopes for the parent VC domain.</p>
<p>7.3 Errors</p>
<p>Errors follow RFC 7807 (application/problem+json) and include error, error_description, and txDid when applicable.</p>
<p>⸻</p>
<ol start="8">
<li>Verification Logic (AS &amp; RS)<ol>
<li>Resolve Transaction DID; cache with ETag/TTL ≤ 5 min.</li>
<li>Validate hub audience: the AS/RS URL MUST appear in a PDTFHubAuthorizationService/PDTFHubResourceService entry.</li>
<li>Verify Trust Registry: each issuer DID MUST appear in the Trust Registry and meet profile requirements.</li>
<li>Verify VPs/VCs: proof, expiry, credentialStatus (fetch status list; cache with ETag), schema.</li>
<li>Verify Participant VC: ensure txDid matches, role is valid, and issuer is authorized.</li>
<li>Apply dynamic access control: for each VC, evaluate termsOfUse.confidentialityLevel against the presented Participant VC:
• Public: include in response
• Restricted: include only if valid Participant VC presented for the transaction
• Confidential: include only if Participant VC role/DID matches requirements in termsOfUse.requiredCredentials</li>
<li>Map Participant VC role to permitted scopes via RAR authorization_details.</li>
<li>Emit/validate DPoP-bound tokens as per §6.</li>
</ol>
</li>
</ol>
<p>⸻</p>
<ol start="9">
<li>Trust Registry
• Publishes issuer DID metadata: DID, supported VC formats, status list endpoints, OID4VCI metadata, and policy flags (e.g., allowed schemas).
• Distribution options: static signed JSON, OpenID Federation, or equivalent.
• AS/RS MUST reject issuers not present or not current in the registry.</li>
</ol>
<p>⸻</p>
<ol start="10">
<li>Lifecycle &amp; Revocation
• Issuers maintain status lists for their VCs; revocation is signaled by flipping the relevant bit or status entry.
• Hubs MUST check status at authorization time and MAY use introspection to proactively deny tokens after revocation.
• Transaction DID Document updates (e.g., changing hubs) take effect as soon as resolvers refresh (≤ 5 min cache).</li>
</ol>
<p>⸻</p>
<ol start="11">
<li>Privacy Considerations
• Subjects use pairwise DIDs per transaction in Participant VCs.
• DID Document lists hubs only; never list participants.
• VCs should minimize exposed claims by design - include only necessary data in credentialSubject.
• Log only VP hashes and presentation_submission; avoid storing raw VPs.</li>
</ol>
<p>⸻</p>
<ol start="12">
<li>Security Considerations
• Enforce TLS 1.2+; pin hostnames from DID Doc service endpoints.
• DPoP to bind tokens to the client key; rotate keys per session where feasible.
• Include nonce and aud in OID4VP requests; reject replayed VPs.
• Time synchronization across hubs/issuers (NTP).
• Key rotation and DID Document updates MUST be atomic and auditable.</li>
</ol>
<p>⸻</p>
<ol start="13">
<li>Inter‑Hub Operation
• Any hub MAY act as AS/RS for a transaction if listed in the Transaction DID Doc.
• A hub&#39;s AS MUST accept Participant VCs issued by any issuer in the Trust Registry (not just itself), subject to Trust Registry and status checks.
• Tokens are audience‑scoped to the target hub’s RS.</li>
</ol>
<p>⸻</p>
<ol start="14">
<li>Example Flows</li>
</ol>
<p>14.1 Onboard Participant 1. Issuer (already in Trust Registry) issues a Participant VC (status OK). 2. Holder stores VC in wallet.</p>
<p>14.2 Access Data (Read) 1. Client → AS /authorize with authorization_details and PEX. 2. Wallet returns VP containing Participant VC. 3. AS verifies Trust Registry + status; issues DPoP‑bound token. 4. Client calls GET /transactions/{txDid}/vcs?type=domain/title on RS. 5. RS validates token/scopes; returns VCs filtered by termsOfUse confidentialityLevel.</p>
<p>14.3 Post New VC (Write) 1. Client obtains scope post:vc:domain/surveys. 2. POST /transactions/{txDid}/vcs with the signed SurveyReportVC. 3. RS validates and persists; 201 Created returned.</p>
<p>14.4 Revoke Participant 1. Issuer flips status for the Participant VC. 2. AS refuses new tokens for that subject/txDid; RS denies upon token expiry or via introspection.</p>
<p>⸻</p>
<ol start="15">
<li>Implementation Profile (Informative)
• Proof suites: Ed25519Signature2020 (MUST) for JSON-LD Linked Data Proofs.
• DPoP: RFC 9449 compliant; max clock skew 60s.
• Token lifetimes: 10 min access, 60 min refresh (typical).
• Caching: DID Doc and status lists cached with ETag; maximum age 5 min.</li>
</ol>
<p>⸻</p>
<ol start="16">
<li>Error Codes (Examples)
• PDTF-TRUST-001 Issuer not in Trust Registry.
• PDTF-TXDID-002 Hub not authorized in Transaction DID.
• PDTF-VC-003 VC schema/type invalid for endpoint.
• PDTF-STATUS-004 VC revoked/unknown status.
• PDTF-SCOPE-005 Insufficient scope for operation.</li>
</ol>
<p>⸻</p>
<ol start="17">
<li>JSON Schemas (Informative excerpts)
• ParticipantVC minimal schema: { credentialSubject: { txDid: string, role: enum }, issuer: DID, credentialStatus: {...} }</li>
</ol>
<p>⸻</p>
<ol start="18">
<li>Versioning &amp; Governance
• This spec version is carried in RS /.well-known/pdtf metadata and MUST be compatible across hubs within a major version.
• Transaction DID updates SHOULD be recorded in a signed change log for audit.</li>
</ol>
<p>⸻</p>
<h2>19. Appendix: Sample Authorization Request (OIDC)</h2>
<pre><code class="language-http">GET /oidc/authorize?response_type=code&amp;client_id=abc&amp;redirect_uri=https%3A%2F%2Fclient.example%2Fcb&amp;scope=openid&amp;authorization_details=%5B...%5D&amp;presentation_definition=%7B...%7D&amp;nonce=N&amp;state=S
</code></pre>
<p><strong>AS verifies:</strong>
• Presentation (OID4VP) → Participant VC valid for txDid and issuer authorized.
• Maps Participant VC role to permitted scopes.
• Issues DPoP‑bound token with aud = RS base.</p>
<p>⸻</p>
<h2>20. Appendix: Sample RS Response</h2>
<pre><code class="language-json">{
  &quot;items&quot;: [
    {
      &quot;type&quot;: [&quot;VerifiableCredential&quot;, &quot;TitleCredential&quot;],
      &quot;issuer&quot;: &quot;did:web:landregistry.example&quot;,
      &quot;validFrom&quot;: &quot;2025-08-19T09:12:00Z&quot;,
      &quot;credentialSubject&quot;: {
        &quot;titleNumber&quot;: &quot;AB123456&quot;, 
        &quot;propertyAddress&quot;: &quot;…&quot;
      },
      &quot;proof&quot;: {
        &quot;type&quot;: &quot;Ed25519Signature2020&quot;, 
        &quot;created&quot;: &quot;2025-08-19T09:12:01Z&quot;, 
        &quot;proofPurpose&quot;: &quot;assertionMethod&quot;, 
        &quot;verificationMethod&quot;: &quot;did:web:landregistry.example#key-1&quot;, 
        &quot;jws&quot;: &quot;eyJhbGciOi...&quot;
      }
    }
  ],
  &quot;txDid&quot;: &quot;did:web:pdtf.example/tx/12345&quot;,
  &quot;version&quot;: &quot;v1&quot;
}
</code></pre>
<p>⸻</p>
<ol start="21">
<li>Open Questions (for review)
• Do we require multi‑sig control on Transaction DID changes?
• Minimum wallet profile for OID4VP/SD‑JWT support?
• Standardize permissions vocabulary beyond examples?
• Should RS support signed receipt acknowledgements for POSTed VCs?</li>
</ol>
<p>⸻</p>

</main>
        </body>
        </html>
